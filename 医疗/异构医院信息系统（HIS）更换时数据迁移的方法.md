## 异构医院信息系统（HIS）更换时数据迁移的方法

http://blog.vsharing.com/blueesse/

1、医院信息系统（HIS）数据迁移需求的提出

​    当下医院搞信息化建设，除了新建医院，大部分医院都不是完全空白，至少会有基础的HIS系统。在医院信息系统更新换代和向临床延伸的路口上，不可避免地有很多医院选择了更换厂商，特别是更换在用的HIS系统。HIS系统涉及医院的人、财、物等运行管理信息，维持着医院的业务运转，数据非常有价值，如果是因为系统更换而使这些数据发生中断，将给医院带来不小的影响。

​    很多医院说换HIS麻烦，麻烦之一就是在用HIS数据不能妥善迁移。很多厂商也不愿意看到医院提出这个需求，因为对任何HIS厂商来说，这同样意味着给自己找麻烦。不过随着用户认知水平的提高和HIS系统对医院运营管理业务的渗透，在用HIS系统数据迁移的需求已变得越来越迫切，甚至到了不迁移，新HIS系统就难以上线的地步。原因如下：

   （1）HIS系统强调整体上线，新老系统更换往往是一夜之间的事，在短暂的时间里重新录入药库、药房库存信息需要耗费大量的人力，越来越不现实；

   （2）大部分住院患者都是医保、农合，第三方支付机构要求有一个完整的住院周期来结算费用，这其中还涉及起付线等，采用老系统出院结算新系统再办理入院的方法或不导入系统切换前明细费用的方式将使患者住院费用无法完整报销。

   （3）很多HIS厂商曾提出了新老两套HIS系统并行的方案，这将大大延长新HIS系统的上线周期，给医院和新HIS厂商均带来长期的折磨。两套系统并行运行将导致使用人员工作量加大，医院账务混乱。与其长痛，还不如下工夫研究数据迁移方法。

​        2、HIS系统更换数据迁移的范围

​        HIS系统更换时，也并非将所有的数据全部进行迁移。数据迁移的范围以保持业务的连续性为准。像门诊历史的就诊、收费记录，出院患者的医嘱、费用信息，如医院无要求可不进行迁移。

​    需要迁移的核心数据如下：

​    （1）基础数据

​    但凡要求进行数据迁移的医院，其基础数据应该相对规范一些。将基础数据（如药品目录、物价目录、医保/农合对应关系、操作员工号等）进行迁移，将大大缩短新系统基础数据的维护时间并继承原有习惯，减少新系统上线后的不适应。

​    （2）药库和药房的库存、价格信息

​    系统更换后，医院的业务不能受到影响，这里面最重要的就是药库、药房的库存。如果新系统中没有药品库存和价格，将导致病人无法取药。所以药库、药房的库存和价格等信息也是要迁移的。通过数据迁移，不需要在系统切换时进行库存盘点和重新录入。系统切换医院人通宵加班的人数可以大大减少。

​    （3）在院患者信息、费用

​    为了保证在院患者数据的连续性，需要将在院患者（包括基本信息、押金信息和费用信息）数据进行迁移。目标只有一句话，在新系统中可以打印出此前明细的费用清单即可。至于床位、护理级别等，可在数据迁移完成后让夜班护士重新分配一下，也算帮忙进行一次人工数据校验。

​    系统更换时，只要能将上述三项数据进行迁移，基本上医院的业务不会受到影响，而且会让使用者感觉过渡非常平稳。剩下的只是软件操作方式、习惯和功能的满足度的问题了。

​        3、HIS系统数据迁移方法

​    提到方法，我们先说异构HIS系统数据迁移面临的困难。新老HIS系统更换，要进行数据迁移，在用HIS系统厂商是很难配合的，既是配合往往开出天价的人工费。所以大部分HIS系统数据迁移都是由院方和新HIS系统厂商配合完成的，在用HIS系统厂商不出面、不配合也不捣乱。所以最大的困难是无法从官方的渠道获取在用HIS系统的数据结构和数据流程，在这种背景下搞数据迁移，方法就很重要了，而且还要有一定的经验积累。

​    具体方法如下：

​    （1）分析在用HIS的数据流程和数据结构

​    在无法直接获取在用HIS系统数据结构和数据流程的情况下，只能靠人工分析了。可先了解在用软件的操作方式，采用数据库事件探查工具（SQL Server是标配，Oracle需要第三方的工具）结合软件操作逐步跟踪数据库的读写操作，搞清楚主要表和字段的意义。这里面没有技巧，只有认真的精神。事实上分析别人家软件的数据流程，也是要看你对自家软件数据流程的熟悉程度，这一点是可以触类旁通的。

   （2）尝试用SQL语句导入

​    在了解在用HIS数据流程的基础上，尝试写一些SQL语句进行数据导入，然后用自家的HIS软件进行数据验证和测试。在通过SQL语句进行数据导入时，不必强调时效性。关键是看能不能导入、导入过程中哪些数据需要转换。毕竟两家厂商的数据结构差别很大，只有通过导入测试，才能为下一步数据迁移程序的开发奠定基础。

​    （3）开发数据迁移程序

​    在分析在用HIS数据流程和结构的基础上，结合自家软件的数据结构开发数据迁移程序，以提高数据迁移的效率和准确性，进行必要的事务控制和逻辑校验。同时还可对不同格式的数据进行批量转换。

​    有了数据迁移程序，即可保证在预定的时间内将在用HIS系统的数据导入到新HIS系统数据库中，缩短因系统切换所带来的停机时间。

   （4）测试数据迁移程序

​    数据迁移程序一定要进行多次测试，并用新HIS程序进行测试和验证。同时还可将迁移出的测试库用作操作人员培训，以增加培训的真实感。

​    （5）执行数据迁移程序

​    系统切换前，要求所有的操作员在老系统中做出规定的操作（这需要根据新HIS系统厂商的要求而定）。然后系统切换时，锁定在用数据库的状态，执行数据迁移程序，将关键数据导入新HIS系统数据库中即可。

​    数据迁移的关键是真正弄明白在用HIS的数据结构和数据流程，并开发出高效率的数据迁移程序。

​    对于如今的HIS厂商而言，想换掉别人家的HIS系统，数据迁移问题基本上难以回避，原因有三：

   （1）用户本身要求

   （2）商务拿单而主动承诺

   （3）系统切换的要求（工期、医保报销政策等原因）

​    所以HIS厂商不应该在一味的牺牲用户利益，拒绝数据迁移要求。对于规模较大的医院，还是有必要进行数据迁移的。能够把别人家的数据迁移过来，也是HIS厂商实力的体现。